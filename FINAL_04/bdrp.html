<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Federated Learning Framework Diagram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
        .icon {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="w-full min-h-screen bg-white p-8 flex items-center justify-center">
        <div class="max-w-5xl w-full">
            <!-- Title -->
            <div class="text-center mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-1">
                    Privacy-Preserving Federated Learning Framework
                </h2>
                <p class="text-sm text-gray-600">Insider Threat Detection System</p>
            </div>

            <!-- Main Diagram Container -->
            <div class="border-2 border-gray-800 rounded-lg p-6 bg-gray-50">
                
                <!-- Top Row: Data Preparation -->
                <div class="mb-4">
                    <div class="bg-blue-100 border-2 border-blue-600 rounded p-3">
                        <div class="font-bold text-sm mb-2 text-blue-900">1. DATA PREPARATION</div>
                        <div class="text-xs text-gray-700 grid grid-cols-4 gap-2">
                            <div class="bg-white p-2 rounded border border-blue-300">
                                <div class="font-semibold">Client 1</div>
                                <div class="text-xs">partition_1.csv</div>
                            </div>
                            <div class="bg-white p-2 rounded border border-blue-300">
                                <div class="font-semibold">Client 2</div>
                                <div class="text-xs">partition_2.csv</div>
                            </div>
                            <div class="bg-white p-2 rounded border border-blue-300">
                                <div class="font-semibold">Client 3</div>
                                <div class="text-xs">partition_3.csv</div>
                            </div>
                            <div class="bg-green-100 p-2 rounded border-2 border-green-600">
                                <div class="font-semibold">Client 4</div>
                                <div class="text-xs font-bold">Test Set</div>
                            </div>
                        </div>
                        <div class="text-xs mt-2 text-gray-600">
                            • Feature Cleaning • Label Annotation • Z-score Standardization • Stratified K-Fold (K=4)
                        </div>
                    </div>
                </div>

                <!-- Arrow -->
                <div class="flex justify-center mb-4">
                    <svg class="text-gray-600" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M19 12l-7 7-7-7"/>
                    </svg>
                </div>

                <!-- Middle Section: Federated Learning Loop -->
                <div class="grid grid-cols-3 gap-4 mb-4">
                    
                    <!-- Left: Server -->
                    <div class="bg-orange-100 border-2 border-orange-600 rounded p-3">
                        <div class="font-bold text-sm mb-2 text-orange-900 flex items-center gap-1">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="8" rx="2" ry="2"/>
                                <rect x="2" y="14" width="20" height="8" rx="2" ry="2"/>
                                <line x1="6" y1="6" x2="6.01" y2="6"/>
                                <line x1="6" y1="18" x2="6.01" y2="18"/>
                            </svg>
                            CENTRAL SERVER
                        </div>
                        <div class="text-xs text-gray-700 space-y-1">
                            <div>• Global Model (MLP)</div>
                            <div>• FedAvg Algorithm</div>
                            <div>• 100 Rounds</div>
                            <div>• Model Distribution</div>
                            <div>• Update Aggregation</div>
                        </div>
                    </div>

                    <!-- Middle: Clients Training -->
                    <div class="bg-purple-100 border-2 border-purple-600 rounded p-3">
                        <div class="font-bold text-sm mb-2 text-purple-900">2. LOCAL TRAINING</div>
                        <div class="text-xs text-gray-700 space-y-1">
                            <div class="font-semibold">Clients 1, 2, 3:</div>
                            <div>• MLP: Input → Hidden (ReLU) → Dropout (0.5) → Sigmoid</div>
                            <div>• Weighted BCE Loss</div>
                            <div>• Class Weighting</div>
                            <div>• Compute Gradients</div>
                        </div>
                    </div>

                    <!-- Right: DP Operations -->
                    <div class="bg-red-100 border-2 border-red-600 rounded p-3">
                        <div class="font-bold text-sm mb-2 text-red-900 flex items-center gap-1">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                            </svg>
                            DP-SGD
                        </div>
                        <div class="text-xs text-gray-700 space-y-1">
                            <div class="font-semibold">Step 1: Clipping</div>
                            <div>• C = 0.5</div>
                            <div class="font-semibold mt-1">Step 2: Noise</div>
                            <div>• σ ∈ {0.25, 0.5, 0.75, 1.0}</div>
                            <div>• N(0, σ²C²)</div>
                        </div>
                    </div>
                </div>

                <!-- Feedback Loop Arrow -->
                <div class="flex justify-center mb-4">
                    <div class="text-xs text-gray-600 bg-gray-200 px-3 py-1 rounded-full border border-gray-400">
                        ← Updates → Aggregation → Model Distribution (Repeat 100 rounds) →
                    </div>
                </div>

                <!-- Arrow -->
                <div class="flex justify-center mb-4">
                    <svg class="text-gray-600" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M19 12l-7 7-7-7"/>
                    </svg>
                </div>

                <!-- Bottom: Evaluation -->
                <div class="bg-green-100 border-2 border-green-600 rounded p-3">
                    <div class="font-bold text-sm mb-2 text-green-900 flex items-center gap-1">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </svg>
                        3. EVALUATION ON HOLDOUT TEST SET
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-xs text-gray-700">
                        <div>
                            <div class="font-semibold mb-1">Metrics:</div>
                            <div>• F1-Score • Precision • Recall • AUC • Accuracy</div>
                        </div>
                        <div class="bg-yellow-50 p-2 rounded border border-yellow-500">
                            <div class="font-bold text-yellow-900">Optimal: σ=0.5, C=0.5</div>
                            <div>F1: 0.6154 | Recall: 0.9412</div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Legend -->
            <div class="mt-4 text-xs text-gray-600 border border-gray-300 rounded p-2 bg-gray-50">
                <div class="font-semibold mb-1">Key:</div>
                <div class="grid grid-cols-3 gap-2">
                    <div>MLP: Multi-Layer Perceptron</div>
                    <div>DP-SGD: Differentially Private SGD</div>
                    <div>BCE: Binary Cross-Entropy</div>
                    <div>FedAvg: Federated Averaging</div>
                    <div>C: Clipping Norm</div>
                    <div>σ: Noise Multiplier</div>
                </div>
            </div>

            <!-- Download Button -->
            <div class="mt-6 text-center">
                <button onclick="downloadDiagram()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg shadow-lg transition duration-200">
                    Download as Image
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        function downloadDiagram() {
            const button = event.target;
            button.style.display = 'none';
            
            html2canvas(document.body, {
                scale: 2,
                backgroundColor: '#ffffff',
                logging: false,
                useCORS: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'federated-learning-framework.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                button.style.display = 'inline-block';
            });
        }
    </script>
</body>
</html>